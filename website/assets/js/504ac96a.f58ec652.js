"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[82874],{15680:(e,n,t)=>{t.d(n,{xA:()=>p,yg:()=>y});var a=t(96540);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var c=a.createContext({}),l=function(e){var n=a.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},p=function(e){var n=l(e.components);return a.createElement(c.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},d=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,c=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=l(t),y=r,m=d["".concat(c,".").concat(y)]||d[y]||u[y]||o;return t?a.createElement(m,i(i({ref:n},p),{},{components:t})):a.createElement(m,i({ref:n},p))}));function y(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,i=new Array(o);i[0]=d;var s={};for(var c in n)hasOwnProperty.call(n,c)&&(s[c]=n[c]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var l=2;l<o;l++)i[l]=t[l];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},96769:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>c,default:()=>y,frontMatter:()=>s,metadata:()=>l,toc:()=>u});var a=t(58168),r=t(98587),o=(t(96540),t(15680)),i=["components"],s={id:"sync",title:"Replicating Data"},c=void 0,l={unversionedId:"sync",id:"version-v3.12.x/sync",title:"Replicating Data",description:"Feature State: The Config resource is currently alpha.",source:"@site/versioned_docs/version-v3.12.x/sync.md",sourceDirName:".",slug:"/sync",permalink:"/gatekeeper/website/docs/v3.12.x/sync",draft:!1,editUrl:"https://github.com/open-policy-agent/gatekeeper/edit/master/website/versioned_docs/version-v3.12.x/sync.md",tags:[],version:"v3.12.x",frontMatter:{id:"sync",title:"Replicating Data"},sidebar:"docs",previous:{title:"Handling Constraint Violations",permalink:"/gatekeeper/website/docs/v3.12.x/violations"},next:{title:"Exempting Namespaces",permalink:"/gatekeeper/website/docs/v3.12.x/exempt-namespaces"}},p={},u=[],d={toc:u};function y(e){var n=e.components,t=(0,r.A)(e,i);return(0,o.yg)("wrapper",(0,a.A)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"Feature State"),": The ",(0,o.yg)("inlineCode",{parentName:"p"},"Config")," resource is currently alpha."),(0,o.yg)("blockquote",null,(0,o.yg)("p",{parentName:"blockquote"},'The "Config" resource must be named ',(0,o.yg)("inlineCode",{parentName:"p"},"config")," for it to be reconciled by Gatekeeper. Gatekeeper will ignore the resource if you do not name it ",(0,o.yg)("inlineCode",{parentName:"p"},"config"),".")),(0,o.yg)("p",null,"Some constraints are impossible to write without access to more state than just the object under test. For example, it is impossible to know if an ingress's hostname is unique among all ingresses unless a rule has access to all other ingresses. To make such rules possible, we enable syncing of data into OPA."),(0,o.yg)("p",null,"The ",(0,o.yg)("a",{parentName:"p",href:"/gatekeeper/website/docs/v3.12.x/audit"},"audit")," feature does not require replication by default. However, when the ",(0,o.yg)("inlineCode",{parentName:"p"},"audit-from-cache")," flag is set to true, the audit informer cache will be used as the source-of-truth for audit queries; thus, an object must first be cached before it can be audited for constraint violations."),(0,o.yg)("p",null,"Kubernetes data can be replicated into the audit cache via the sync config resource. Currently resources defined in ",(0,o.yg)("inlineCode",{parentName:"p"},"syncOnly")," will be synced into OPA. Updating ",(0,o.yg)("inlineCode",{parentName:"p"},"syncOnly")," should dynamically update what objects are synced. Below is an example:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: config.gatekeeper.sh/v1alpha1\nkind: Config\nmetadata:\n  name: config\n  namespace: "gatekeeper-system"\nspec:\n  sync:\n    syncOnly:\n      - group: ""\n        version: "v1"\n        kind: "Namespace"\n      - group: ""\n        version: "v1"\n        kind: "Pod"\n')),(0,o.yg)("p",null,"You can install this config with the following command:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-sh"},"kubectl apply -f https://raw.githubusercontent.com/open-policy-agent/gatekeeper/master/demo/basic/sync.yaml\n")),(0,o.yg)("p",null,"Once data is synced into OPA, rules can access the cached data under the ",(0,o.yg)("inlineCode",{parentName:"p"},"data.inventory")," document."),(0,o.yg)("p",null,"The ",(0,o.yg)("inlineCode",{parentName:"p"},"data.inventory")," document has the following format:"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"For cluster-scoped objects: ",(0,o.yg)("inlineCode",{parentName:"li"},"data.inventory.cluster[<groupVersion>][<kind>][<name>]"),(0,o.yg)("ul",{parentName:"li"},(0,o.yg)("li",{parentName:"ul"},"Example referencing the Gatekeeper namespace: ",(0,o.yg)("inlineCode",{parentName:"li"},'data.inventory.cluster["v1"].Namespace["gatekeeper"]')))),(0,o.yg)("li",{parentName:"ul"},"For namespace-scoped objects: ",(0,o.yg)("inlineCode",{parentName:"li"},"data.inventory.namespace[<namespace>][groupVersion][<kind>][<name>]"),(0,o.yg)("ul",{parentName:"li"},(0,o.yg)("li",{parentName:"ul"},"Example referencing the Gatekeeper pod: ",(0,o.yg)("inlineCode",{parentName:"li"},'data.inventory.namespace["gatekeeper"]["v1"]["Pod"]["gatekeeper-controller-manager-d4c98b788-j7d92"]'))))))}y.isMDXComponent=!0}}]);